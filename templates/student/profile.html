{% extends 'base.html' %}

{% block title %}个人资料{% endblock %}

{% block styles %}
<style>
    .page-header {
        padding: 20px 0;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
    }
    
    .card {
        margin-bottom: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .card-header {
        background-color: #f8f9fa;
        border-radius: 10px 10px 0 0 !important;
        font-weight: 500;
    }
    
    .profile-header {
        position: relative;
        padding: 20px;
        background: linear-gradient(135deg, #6c757d, #343a40);
        color: white;
        border-radius: 10px 10px 0 0;
    }
    
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
    }
    
    .profile-info {
        margin-left: 20px;
    }
    
    .tab-pane {
        padding: 20px 0;
    }
    
    .form-label {
        font-weight: 500;
    }
    
    .required-field::after {
        content: "*";
        color: red;
        margin-left: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="page-header">
        <h1>个人资料</h1>
        <p class="text-muted">查看和管理您的个人信息</p>
    </div>

    <div id="messageContainer"></div>
    
    <div class="card">
        <div class="profile-header d-flex">
            <img src="/static/img/placeholder.png" alt="头像" class="profile-avatar">
            <div class="profile-info d-flex flex-column justify-content-center">
                <h2>张三</h2>
                <p class="mb-0">学生 · 高中二年级</p>
                <p class="text-white-50">ID: ST20230515</p>
            </div>
        </div>
        
        <div class="card-body p-0">
            <ul class="nav nav-tabs nav-fill" id="profileTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">基本信息</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab" aria-controls="security" aria-selected="false">安全设置</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="preferences-tab" data-bs-toggle="tab" data-bs-target="#preferences" type="button" role="tab" aria-controls="preferences" aria-selected="false">偏好设置</button>
                </li>
            </ul>
            <div class="tab-content p-4" id="profileTabContent">
                <!-- 基本信息 -->
                <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                    <form id="basicInfoForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="username" class="form-label required-field">用户名</label>
                                <input type="text" class="form-control" id="username" value="zhangsan" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="realName" class="form-label required-field">真实姓名</label>
                                <input type="text" class="form-control" id="realName" value="张三" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentId" class="form-label required-field">学号</label>
                                <input type="text" class="form-control" id="studentId" value="ST20230515" readonly>
                                <div class="form-text">学号不可修改</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label required-field">电子邮箱</label>
                                <input type="email" class="form-control" id="email" value="zhangsan@example.com" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">手机号码</label>
                                <input type="tel" class="form-control" id="phone" value="13800138000">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="grade" class="form-label required-field">年级</label>
                                <select class="form-select" id="grade" required>
                                    <option value="">选择年级</option>
                                    <option value="高一">高中一年级</option>
                                    <option value="高二" selected>高中二年级</option>
                                    <option value="高三">高中三年级</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="avatar" class="form-label">更换头像</label>
                            <input type="file" class="form-control" id="avatar" accept="image/*">
                        </div>
                        
                        <div class="mb-3">
                            <label for="bio" class="form-label">个人简介</label>
                            <textarea class="form-control" id="bio" rows="3">我是一名高中二年级学生，喜欢数学和物理。</textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">保存修改</button>
                    </form>
                </div>
                
                <!-- 安全设置 -->
                <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
                    <h4 class="mb-4">安全设置</h4>
                    
                    <form id="passwordForm" class="mb-4">
                        <h5>修改密码</h5>
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label required-field">当前密码</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label required-field">新密码</label>
                            <input type="password" class="form-control" id="newPassword" required>
                            <div class="form-text">密码长度至少为8位，包含字母和数字</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label required-field">确认新密码</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">更新密码</button>
                    </form>
                    
                    <hr>
                    
                    <h5 class="mb-3">登录状态</h5>
                    <div class="mb-3">
                        <p>上次登录时间: 2023-05-15 14:30:25</p>
                        <p>上次登录IP: 192.168.1.100</p>
                        <p>当前登录设备: Chrome on Windows</p>
                    </div>
                    
                    <button type="button" class="btn btn-danger" id="logoutAllBtn">退出所有设备</button>
                </div>
                
                <!-- 偏好设置 -->
                <div class="tab-pane fade" id="preferences" role="tabpanel" aria-labelledby="preferences-tab">
                    <h4 class="mb-4">偏好设置</h4>
                    
                    <form id="preferencesForm">
                        <h5 class="mb-3">界面设置</h5>
                        <div class="mb-3">
                            <label for="theme" class="form-label">主题</label>
                            <select class="form-select" id="theme">
                                <option value="light" selected>浅色主题</option>
                                <option value="dark">深色主题</option>
                                <option value="system">跟随系统</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="language" class="form-label">语言</label>
                            <select class="form-select" id="language">
                                <option value="zh_CN" selected>简体中文</option>
                                <option value="en_US">English</option>
                            </select>
                        </div>
                        
                        <h5 class="mb-3 mt-4">其他设置</h5>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="enableNotifications" checked>
                            <label class="form-check-label" for="enableNotifications">
                                启用网站通知
                            </label>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="enableSounds" checked>
                            <label class="form-check-label" for="enableSounds">
                                启用声音提醒
                            </label>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="showOnlineStatus" checked>
                            <label class="form-check-label" for="showOnlineStatus">
                                显示在线状态
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">保存设置</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 基本信息表单提交
        document.getElementById('basicInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const formData = {
                username: document.getElementById('username').value,
                realName: document.getElementById('realName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                grade: document.getElementById('grade').value,
                bio: document.getElementById('bio').value
            };
            
            console.log('提交基本信息:', formData);
            
            // 模拟API请求
            setTimeout(() => {
                showMessage('个人信息已更新', 'success');
            }, 500);
        });
        
        // 修改密码表单提交
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // 简单验证
            if (!currentPassword || !newPassword || !confirmPassword) {
                showMessage('请填写所有密码字段', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('两次输入的新密码不一致', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showMessage('新密码长度应至少为8位', 'error');
                return;
            }
            
            console.log('提交密码修改');
            
            // 模拟API请求
            setTimeout(() => {
                showMessage('密码已成功更新', 'success');
                this.reset();
            }, 500);
        });
        
        // 偏好设置表单提交
        document.getElementById('preferencesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const formData = {
                theme: document.getElementById('theme').value,
                language: document.getElementById('language').value,
                enableNotifications: document.getElementById('enableNotifications').checked,
                enableSounds: document.getElementById('enableSounds').checked,
                showOnlineStatus: document.getElementById('showOnlineStatus').checked
            };
            
            console.log('提交偏好设置:', formData);
            
            // 模拟API请求
            setTimeout(() => {
                showMessage('偏好设置已更新', 'success');
            }, 500);
        });
        
        // 退出所有设备按钮
        document.getElementById('logoutAllBtn').addEventListener('click', function() {
            if (confirm('确定要退出所有设备吗？这将使所有其他登录失效。')) {
                console.log('退出所有设备');
                
                // 模拟API请求
                setTimeout(() => {
                    showMessage('已成功退出所有设备', 'success');
                }, 500);
            }
        });
        
        // 头像预览
        document.getElementById('avatar').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.querySelector('.profile-avatar').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    });
    
    // 显示消息函数
    function showMessage(message, type) {
        const messageContainer = document.getElementById('messageContainer');
        const alertClass = type === 'error' ? 'danger' : type;
        
        const alertHtml = `
            <div class="alert alert-${alertClass} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        
        messageContainer.innerHTML = alertHtml;
        
        // 5秒后自动关闭
        setTimeout(() => {
            const alert = messageContainer.querySelector('.alert');
            if (alert) {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 150);
            }
        }, 5000);
    }
</script>
{% endblock %} 