{% extends 'base.html' %}

{% block title %}学生仪表盘{% endblock %}

{% block styles %}
<style>
    .dashboard-container {
        padding: 20px 5px;
    }
    
    .card {
        margin-bottom: 20px;
        border-radius: 10px;
        overflow: hidden;
    }
    
    .card-header {
        padding: 15px 20px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .card-header h4 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
    }
    
    .question-item, .notification-item {
        padding: 15px;
        border-bottom: 1px solid #f5f5f5;
    }
    
    .question-item:last-child, .notification-item:last-child {
        border-bottom: none;
    }
    
    .question-text, .notification-text {
        margin-bottom: 8px;
    }
    
    .question-meta, .notification-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85em;
        color: #666;
    }
    
    .badge {
        padding: 5px 10px;
        font-weight: 500;
        border-radius: 50px;
    }
    
    .time-ago {
        color: #7f8c8d;
    }
    
    .answer {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
    }
    
    .answer-label {
        font-weight: bold;
        font-size: 0.85em;
        color: #333;
        margin-bottom: 5px;
    }
    
    .course-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #f5f5f5;
        transition: background-color 0.2s;
    }
    
    .course-item:hover {
        background-color: #f9f9f9;
    }
    
    .course-item:last-child {
        border-bottom: none;
    }
    
    .course-name {
        font-weight: 500;
    }
    
    .voting-options {
        margin-top: 15px;
    }
    
    .voting-option {
        margin-bottom: 10px;
    }
    
    .option-label {
        font-weight: normal;
        width: 100%;
        cursor: pointer;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        transition: all 0.2s;
        display: block;
    }
    
    .option-label:hover {
        background-color: #f5f5f5;
    }
    
    input[type="radio"]:checked + .option-label {
        background-color: #e8f4ff;
        border-color: #b8daff;
    }
    
    .action-button {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.8) 0%, rgba(52, 152, 219, 1) 100%);
        color: white;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .action-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .action-button i {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    
    .action-button.purple {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.8) 0%, rgba(142, 68, 173, 1) 100%);
    }
    
    .action-button.green {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.8) 0%, rgba(39, 174, 96, 1) 100%);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    <h1 class="page-title">学生仪表盘</h1>
    
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="action-button d-flex flex-column align-items-center">
                <i class="fas fa-question-circle"></i>
                <h5>提出问题</h5>
                <p class="small mb-0">向老师提出你的疑问</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="action-button purple d-flex flex-column align-items-center">
                <i class="fas fa-poll"></i>
                <h5>参与投票</h5>
                <p class="small mb-0">参与课堂投票活动</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="action-button green d-flex flex-column align-items-center">
                <i class="fas fa-comment-alt"></i>
                <h5>提交反馈</h5>
                <p class="small mb-0">提交关于课程的反馈</p>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- 左侧栏 - 课堂互动 -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-comments text-primary me-2"></i>课堂互动</h4>
                </div>
                <div class="card-body">
                    <!-- 最近问题 -->
                    <h5 class="mb-3">最近问题</h5>
                    <div class="recent-questions">
                        <div class="question-item">
                            <div class="question-text">如何理解牛顿三定律？</div>
                            <div class="question-meta">
                                <span class="badge bg-success">已回答</span>
                                <span class="time-ago">3分钟前</span>
                            </div>
                            <div class="answer mt-2">
                                <div class="answer-label">回答:</div>
                                <div class="answer-text">牛顿三定律是经典力学的基础，包括惯性定律、动量定律和作用力与反作用力定律。这些定律解释了物体运动的基本原理。</div>
                            </div>
                        </div>
                        
                        <div class="question-item">
                            <div class="question-text">请问下周考试范围是什么？</div>
                            <div class="question-meta">
                                <span class="badge bg-secondary">待回答</span>
                                <span class="time-ago">昨天</span>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2">
                                <i class="fas fa-plus-circle me-1"></i>补充问题
                            </button>
                        </div>
                    </div>
                    
                    <!-- 活跃投票 -->
                    <h5 class="mt-4 mb-3">活跃投票</h5>
                    <div class="active-poll">
                        <div class="poll-question mb-3">
                            <strong>你最喜欢的学习方式是什么？</strong>
                        </div>
                        <form id="vote-form" data-poll-id="1">
                            <div class="voting-options">
                                <div class="voting-option">
                                    <input type="radio" name="poll-option" id="option1" value="1" class="d-none">
                                    <label for="option1" class="option-label">课堂讲解</label>
                                </div>
                                <div class="voting-option">
                                    <input type="radio" name="poll-option" id="option2" value="2" class="d-none">
                                    <label for="option2" class="option-label">小组讨论</label>
                                </div>
                                <div class="voting-option">
                                    <input type="radio" name="poll-option" id="option3" value="3" class="d-none">
                                    <label for="option3" class="option-label">实验操作</label>
                                </div>
                                <div class="voting-option">
                                    <input type="radio" name="poll-option" id="option4" value="4" class="d-none">
                                    <label for="option4" class="option-label">自主学习</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mt-3" id="submit-vote">提交投票</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- 当前课程 -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-book text-primary me-2"></i>当前课程</h4>
                </div>
                <div class="card-body p-0">
                    <div class="current-courses">
                        <div class="course-item">
                            <div class="course-name">物理学</div>
                            <div class="course-meta">
                                <span class="badge bg-success">进行中</span>
                            </div>
                        </div>
                        <div class="course-item">
                            <div class="course-name">数学</div>
                            <div class="course-meta">
                                <span class="badge bg-secondary">今天</span>
                            </div>
                        </div>
                        <div class="course-item">
                            <div class="course-name">化学</div>
                            <div class="course-meta">
                                <span class="badge bg-secondary">明天</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 最近通知 -->
            <div class="card">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-bell text-primary me-2"></i>最近通知</h4>
                </div>
                <div class="card-body p-0">
                    <div class="recent-notifications">
                        <div class="notification-item">
                            <div class="notification-text">下周三物理课将进行小测验，请做好准备。</div>
                            <div class="notification-meta">
                                <span class="time-ago">刚刚</span>
                            </div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-text">化学实验报告截止日期延长至下周五。</div>
                            <div class="notification-meta">
                                <span class="time-ago">2小时前</span>
                            </div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-text">请所有同学在周五前完成数学作业。</div>
                            <div class="notification-meta">
                                <span class="time-ago">昨天</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 提问模态框 -->
<div class="modal fade" id="ask-question-modal" tabindex="-1" aria-labelledby="askQuestionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="askQuestionModalLabel">提出问题</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="question-form">
                    <div class="mb-3">
                        <label for="question-text" class="form-label">您的问题：</label>
                        <textarea class="form-control" id="question-text" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="submit-question">提交问题</button>
            </div>
        </div>
    </div>
</div>

<!-- 反馈模态框 -->
<div class="modal fade" id="feedback-modal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">提交反馈</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="feedback-form">
                    <div class="mb-3">
                        <label for="feedback-text" class="form-label">您的反馈：</label>
                        <textarea class="form-control" id="feedback-text" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="submit-feedback">提交反馈</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 角色验证
        const userData = localStorage.getItem('userData');
        if (userData) {
            try {
                const user = JSON.parse(userData);
                if (user.role !== 'student') {
                    console.error('非学生角色访问学生仪表盘');
                    setTimeout(() => {
                        window.location.href = user.role === 'teacher' ? '/teacher/dashboard' : '/';
                    }, 2000);
                    return;
                }
            } catch (e) {
                console.error('解析用户数据出错:', e);
            }
        }
        
        // 提问按钮点击事件
        document.querySelector('.action-button:first-child').addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('ask-question-modal'));
            modal.show();
        });
        
        // 提交问题按钮点击事件
        document.getElementById('submit-question').addEventListener('click', function() {
            const questionText = document.getElementById('question-text').value.trim();
            if (!questionText) {
                alert('请输入问题内容');
                return;
            }
            
            // 提交问题的逻辑
            console.log('提交问题:', questionText);
            
            // 关闭模态框并清空输入
            bootstrap.Modal.getInstance(document.getElementById('ask-question-modal')).hide();
            document.getElementById('question-text').value = '';
            
            // 显示成功消息
            alert('问题提交成功！');
        });
        
        // 提交反馈按钮点击事件
        document.querySelector('.action-button.green').addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('feedback-modal'));
            modal.show();
        });
        
        // 提交反馈的处理
        document.getElementById('submit-feedback').addEventListener('click', function() {
            const feedbackText = document.getElementById('feedback-text').value.trim();
            if (!feedbackText) {
                alert('请输入反馈内容');
                return;
            }
            
            // 提交反馈的逻辑
            console.log('提交反馈:', feedbackText);
            
            // 关闭模态框并清空输入
            bootstrap.Modal.getInstance(document.getElementById('feedback-modal')).hide();
            document.getElementById('feedback-text').value = '';
            
            // 显示成功消息
            alert('反馈提交成功！');
        });
        
        // 参与投票按钮点击事件
        document.querySelector('.action-button.purple').addEventListener('click', function() {
            // 滚动到投票区域
            document.querySelector('.active-poll').scrollIntoView({ behavior: 'smooth' });
        });
        
        // 投票表单提交事件
        document.getElementById('vote-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedOption = document.querySelector('input[name="poll-option"]:checked');
            if (!selectedOption) {
                alert('请选择一个选项');
                return;
            }
            
            // 提交投票的逻辑
            console.log('提交投票, 选项:', selectedOption.value);
            
            // 禁用表单，防止重复提交
            document.querySelectorAll('#vote-form input').forEach(input => input.disabled = true);
            document.getElementById('submit-vote').disabled = true;
            document.getElementById('submit-vote').textContent = '已提交';
            
            // 显示成功消息
            alert('投票提交成功！');
        });
        
        // 补充问题按钮点击事件
        document.querySelector('.btn-outline-primary').addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('ask-question-modal'));
            modal.show();
        });
    });
</script>
{% endblock %} 