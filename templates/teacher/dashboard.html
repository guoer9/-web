{% extends 'base.html' %}

{% block title %}教师仪表盘{% endblock %}

{% block styles %}
<style>
    .dashboard-container {
        padding: 20px 5px;
    }
    
    .card {
        margin-bottom: 20px;
        border-radius: 10px;
        overflow: hidden;
    }
    
    .card-header {
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .card-header h4 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
    }
    
    .list-group-item {
        border: none;
        border-bottom: 1px solid #f5f5f5;
        padding: 12px 20px;
    }
    
    .recent-question {
        padding: 15px;
        border-bottom: 1px solid #f5f5f5;
    }
    
    .question-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    
    .question-author {
        font-weight: 500;
        color: #3498db;
    }
    
    .question-time {
        color: #7f8c8d;
        font-size: 0.85rem;
    }
    
    .quick-action-card {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.8) 0%, rgba(52, 152, 219, 1) 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        height: 100%;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .quick-action-card:hover {
        transform: translateY(-5px);
    }
    
    .quick-action-card.purple {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.8) 0%, rgba(142, 68, 173, 1) 100%);
    }
    
    .quick-action-card.green {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.8) 0%, rgba(39, 174, 96, 1) 100%);
    }
    
    .quick-action-card.orange {
        background: linear-gradient(135deg, rgba(230, 126, 34, 0.8) 0%, rgba(211, 84, 0, 1) 100%);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    <h1 class="page-title">教师仪表盘</h1>
    
    <!-- 快速操作区 -->
    <div class="row mb-4">
        <div class="col-md-3 mb-4">
            <div class="quick-action-card d-flex flex-column align-items-center text-center">
                <i class="fas fa-plus-circle fa-2x mb-3"></i>
                <h5>创建新讨论</h5>
                <p class="small mb-0">发起一个新的课堂话题讨论</p>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="quick-action-card purple d-flex flex-column align-items-center text-center">
                <i class="fas fa-poll fa-2x mb-3"></i>
                <h5>发布投票</h5>
                <p class="small mb-0">创建一个新的课堂投票</p>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="quick-action-card green d-flex flex-column align-items-center text-center">
                <i class="fas fa-file-alt fa-2x mb-3"></i>
                <h5>安排小测验</h5>
                <p class="small mb-0">创建一个新的课堂测验</p>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="quick-action-card orange d-flex flex-column align-items-center text-center">
                <i class="fas fa-users fa-2x mb-3"></i>
                <h5>查看学生名单</h5>
                <p class="small mb-0">管理班级学生信息</p>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- 左侧栏 - 最近问题 -->
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-question-circle text-primary me-2"></i>最近问题</h4>
                </div>
                <div class="card-body p-0">
                    <div class="recent-question">
                        <div class="question-header">
                            <span class="question-author">张三</span>
                            <span class="question-time">昨天</span>
                        </div>
                        <div class="question-content">
                            <p>老师下周考试的范围是什么？是否包含选择题？</p>
                        </div>
                        <div class="question-actions">
                            <button class="btn btn-sm btn-outline-primary"><i class="fas fa-reply me-1"></i>回复</button>
                            <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-share me-1"></i>分享给全班</button>
                        </div>
                    </div>
                    
                    <div class="recent-question">
                        <div class="question-header">
                            <span class="question-author">李四</span>
                            <span class="question-time">2小时前</span>
                        </div>
                        <div class="question-content">
                            <p>老师您讲解一下牛顿第三定律是什么？</p>
                        </div>
                        <div class="question-actions">
                            <button class="btn btn-sm btn-outline-primary"><i class="fas fa-reply me-1"></i>回复</button>
                            <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-share me-1"></i>分享给全班</button>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <button class="btn btn-outline-primary btn-sm">查看所有问题</button>
                </div>
            </div>
            
            <!-- 当前投票 -->
            <div class="card">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-poll text-primary me-2"></i>当前投票</h4>
                </div>
                <div class="card-body">
                    <h5>你最喜欢的学习方式是什么？</h5>
                    <p class="text-muted mb-3">创建于：今天 10:30 | 已有19名学生参与</p>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>课堂讲解</span>
                            <span>45%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>小组讨论</span>
                            <span>25%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>实验操作</span>
                            <span>20%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-info" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between">
                    <button class="btn btn-outline-success btn-sm">导出结果</button>
                    <button class="btn btn-outline-danger btn-sm">结束投票</button>
                </div>
            </div>
        </div>
        
        <!-- 右侧栏 - 课程统计 -->
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h4><i class="fas fa-chart-line text-primary me-2"></i>课程统计</h4>
                </div>
                <div class="card-body">
                    <h5>课程参与度</h5>
                    <div class="list-group mb-3">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            学生提问数
                            <span class="badge bg-primary rounded-pill">24</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            投票参与率
                            <span class="badge bg-success rounded-pill">87%</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            讨论活跃度
                            <span class="badge bg-info rounded-pill">中等</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            平均反馈评分
                            <span class="badge bg-warning rounded-pill">4.2/5</span>
                        </div>
                    </div>
                    
                    <h5>课程进度</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">65%</div>
                    </div>
                    
                    <h5>学生反馈概览</h5>
                    <div class="alert alert-success">
                        最近反馈总体积极，课程难度适中，互动性良好。
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 角色验证 - 确保只有教师可以访问该页面
        const userData = localStorage.getItem('userData');
        if (userData) {
            try {
                const user = JSON.parse(userData);
                if (user.role !== 'teacher') {
                    console.error('非教师角色访问教师仪表盘');
                    setTimeout(() => {
                        window.location.href = user.role === 'student' ? '/student/dashboard' : '/';
                    }, 2000);
                    return;
                }
            } catch (e) {
                console.error('解析用户数据出错:', e);
            }
        }
        
        // 绑定快速操作卡片点击事件
        document.querySelectorAll('.quick-action-card').forEach(card => {
            card.addEventListener('click', function() {
                const action = this.querySelector('h5').textContent;
                console.log('快速操作:', action);
                
                switch(action) {
                    case '创建新讨论':
                        window.location.href = '/teacher/discussions';
                        break;
                    case '发布投票':
                        window.location.href = '/teacher/interactions';
                        break;
                    case '安排小测验':
                        window.location.href = '/teacher/quizzes';
                        break;
                    case '查看学生名单':
                        window.location.href = '/teacher/students';
                        break;
                }
            });
        });
    });
</script>
{% endblock %} 